<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timer</title>

  <style>
    body {
      overflow: hidden;
      background-color: skyblue;
    }

    .Timer-CountWrappper {
      display: flex;
      align-items: center;
    }

    .Timer {
      display: flex;
      display: -webkit-flex;
      flex-direction: column;
      -ms-flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .TimerWrapper {
      width: 100%;
      height: 100vh;
      display: flex;
      display: -webkit-flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .Timer-TopWrapper {
      display: flex;
      display: -webkit-flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .Timer-TopWrapper > * {
      margin-right: 5px;
      border: none;
      outline: none;
      color: white;
      padding: 10px 0;
      font-size: 20px;
      border-radius: 10px;
      cursor: pointer;
      width: 150px;
    }

    .Timer-TopWrapper-LAB {
      background-color: greenyellow;
    }

    .Timer-TopWrapper-StartStop {
      background-color: red;
    }

    .Timer-TopWrapper-Reset {
      background-color: blue;
    }

    .Timer-BodyWrapper {
      width: 500px;
      height: 500px;
      border: 3px solid white;
      color: white;
      font-size: 25px;
      border-radius: 50%;
      display: flex;
      display: -webkit-flex;
      justify-content: center;
      align-items: center;
    }

    .Timer-Record {
      margin-left: 1rem;
      background-color: blue;
      border-radius: 10px;
      width: 400px;
      height: 500px;
      overflow-x: hidden;
      overflow-y: auto;
    }

    li {
      list-style: none;
      margin: 10px 0;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="TimerWrapper">
    <div class="Timer-CountWrappper">
      <div class ="Timer">
        <div class="Timer-TopWrapper">
          <button id ="lab" class="Timer-TopWrapper-LAB" onclick="saveRecordLog();">LAB</button>
          <button id ="startStop" class="Timer-TopWrapper-StartStop" onclick="clickStartStop();">Start/Stop</button>
          <button class="Timer-TopWrapper-Reset" onclick="resetTimer();">Reset</button>
        </div>

        <div class="Timer-BodyWrapper">
          <div id ="currentTimer">00:00:00</div>
        </div>
      </div>

      <div class ="Timer-Record">
        <ul id ="recordList" class ="Timer-Record-List">

        </ul>
      </div>
    </div>

    <div>
      <div id ="maxRecord"></div>
      <div id ="averageRecord"></div>
    </div>
  </div>

  <script>
    const currentTimer = document.getElementById('currentTimer');
    const startStop = document.getElementById('startStop');
    const lab = document.getElementById('lab');
    const recordList = document.getElementById('recordList');

    const maxRecord = document.getElementById('maxRecord');
    const averageRecord = document.getElementById('averageRecord');

    let logIndex = 0;
    let isStart = false;
    let minutes = 0;
    let seconds = 0;
    let milliSeconds = 0;
    let count = 0;

    const resetTimer = () => {
      while (recordList.firstChild) {
        recordList.removeChild(recordList.firstChild);
      }

      minutes = 0;
      seconds = 0;
      milliSeconds = 0;
      logIndex = 0;

      currentTimer.innerHTML = `${minutes < 10 ? '0' + minutes : minutes}:${seconds < 10 ? '0' + seconds : seconds}:${milliSeconds < 10 ? '0' + milliSeconds : milliSeconds}`;
    }

    const saveRecordLog = () => {
      if (!minutes && !seconds && !milliSeconds) {
        return;
      }

      logIndex++;
      const logContent = `${minutes < 10 ? '0' + minutes : minutes}:${seconds < 10 ? '0' + seconds : seconds}:${milliSeconds < 10 ? '0' + milliSeconds : milliSeconds}`;
      const liTag = document.createElement('li');
      liTag.append(logContent);
      liTag.setAttribute('id', logIndex);
      recordList.append(liTag);

      calculateRecord();
    }

    const calculateRecord = () => {
      let averageMinute = 0;
      let averageSecond = 0;
      let averageMilliSecond = 0;

      const childLength = recordList.children.length;
      const splitMaxTime = recordList.children[childLength - 1].innerHTML.split(":");

      for (let i = 0; i < childLength; i++) {
        // 0번째: 분, 1번째: 초, 2번째: 밀리세컨드
        const splitTime = recordList.children[i].innerHTML.split(":");
        
        averageMinute += Number(splitTime[0]);
        averageSecond += Number(splitTime[1]);
        averageMilliSecond += Number(splitTime[2]);
      }

      averageMinute = Math.floor(averageMinute / childLength);
      averageSecond = Math.floor(averageSecond / childLength);
      averageMilliSecond = Math.floor(averageMilliSecond / childLength);

      averageRecord.innerHTML = `평균 시간: ${averageMinute}분 ${averageSecond}초 ${averageMilliSecond} 밀리세컨드`;
      maxRecord.innerHTML = `가장 큰시간: ${splitMaxTime[0]}분 ${splitMaxTime[1]}초 ${splitMaxTime[2]} 밀리세컨드`;
    }
    
    const clickStartStop = () => {
      isStart = !isStart;
      count++;

      const interval = setInterval(() => {
        if (isStart) {
          milliSeconds++;

          if (milliSeconds >= 100) {
            seconds++;
            milliSeconds = 0;

            if (seconds >= 60) {
              seconds = 0;
              minutes++;
            }
          }
          currentTimer.innerHTML = `${minutes < 10 ? '0' + minutes : minutes}:${seconds < 10 ? '0' + seconds : seconds}:${milliSeconds < 10 ? '0' + milliSeconds : milliSeconds}`;
        }
      }, count < 2 ? 10 : 1000);
    };
  </script>
</body>
</html>